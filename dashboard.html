<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baseline Polyfill CDN+</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 p-6 font-sans">
  <div class="max-w-7xl mx-auto">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl font-extrabold tracking-tight">Baseline Polyfill CDN+</h1>
        <p class="mt-1 text-gray-600">Select features and baseline year to see live polyfill demo.</p>
      </div>
      <div id="badge" class="inline-block px-3 py-1 rounded-full bg-indigo-600 text-white font-medium">
        Baseline 2024 • 0 feature(s)
      </div>
    </header>

    <main class="grid md:grid-cols-3 gap-6">
      <!-- Config Panel -->
      <section class="md:col-span-1 bg-white p-5 rounded-lg shadow">
        <h2 class="text-lg font-semibold mb-3">Configure</h2>

        <label class="block text-sm font-medium mb-1">Target Baseline Year</label>
        <div id="year-buttons" class="flex gap-2 mb-4"></div>

        <label class="block text-sm font-medium mb-2">Features</label>
        <div id="features-list" class="space-y-2 mb-4"></div>

        <label class="block text-sm font-medium mb-2">Script Snippet</label>
        <div class="relative">
          <textarea id="snippet" readonly class="w-full p-2 border rounded text-sm h-24 bg-gray-50"></textarea>
          <button id="copy-btn" class="absolute right-2 top-2 px-3 py-1 bg-indigo-600 text-white rounded">Copy</button>
        </div>
      </section>

      <!-- Live Preview -->
      <section class="md:col-span-2 bg-white p-5 rounded-lg shadow">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold">Live Preview</h2>
          <div class="text-sm text-gray-500">Auto-refreshing demo</div>
        </div>

        <div class="border rounded overflow-hidden">
          <iframe id="preview" class="w-full h-[600px]"></iframe>
        </div>
      </section>
    </main>

    <footer class="mt-6 text-sm text-gray-500 text-center">
      Made for Baseline Tooling Hackathon — fully functional demo
    </footer>
  </div>

  <script>
    const years = [2023,2024,2025,2026,2027];
    const featureList = [
      {id:"fetch", name:"fetch()"},
      {id:"intl-segmenter", name:"Intl.Segmenter"},
      {id:"promise-any", name:"Promise.any"},
      {id:"array-flatmap", name:"Array.flatMap"},
      {id:"object-from-entries", name:"Object.fromEntries"},
      {id:"string-replaceall", name:"String.replaceAll"},
      {id:"promise-allsettled", name:"Promise.allSettled"},
      {id:"globalThis", name:"globalThis"},
      {id:"weakref", name:"WeakRef"},
      {id:"urlsearchparams", name:"URLSearchParams"}
    ];

    let target = 2024;
    let features = {};
    featureList.forEach(f => features[f.id] = true);

    const yearButtons = document.getElementById("year-buttons");
    const featuresDiv = document.getElementById("features-list");
    const snippetBox = document.getElementById("snippet");
    const preview = document.getElementById("preview");
    const badge = document.getElementById("badge");

    function updateUI(){
      const selected = Object.keys(features).filter(k=>features[k]);
      const qs = selected.join(",");
      const snippet = `<script src="/polyfill.js?target=${target}&features=${qs}"></script>`;
      snippetBox.value = snippet;
      badge.innerText = `Baseline ${target} • ${selected.length} feature(s)`;
      preview.src = `/demo.html?target=${target}&features=${qs}`;
    }

    years.forEach(y=>{
      const btn=document.createElement("button");
      btn.innerText=y;
      btn.className="px-3 py-1 rounded-md border hover:bg-indigo-50";
      btn.onclick=()=>{target=y;updateUI();};
      yearButtons.appendChild(btn);
    });

    featureList.forEach(f=>{
      const label=document.createElement("label");
      label.className="flex items-center gap-3";
      const input=document.createElement("input");
      input.type="checkbox";
      input.checked=features[f.id];
      input.className="h-4 w-4 text-indigo-600 border-gray-300 rounded";
      input.onchange=()=>{features[f.id]=input.checked;updateUI();};
      label.appendChild(input);
      const span=document.createElement("span");
      span.innerText=f.name;
      span.className="text-sm";
      label.appendChild(span);
      featuresDiv.appendChild(label);
    });

    document.getElementById("copy-btn").onclick=async()=>{
      await navigator.clipboard.writeText(snippetBox.value);
      alert("Copied!");
    };

    updateUI();
  </script>
</body>
</html>
